{% extends 'posts/base.html' %}

{% block title %}Поиск - Мой Блог{% endblock %}

{% block content %}
<div class="search-header">
    <h1>Результаты поиска</h1>
    {% if query %}<p>По запросу "{{ query }}" найдено {{ posts.count }} результатов</p>{% endif %}
</div>

{% if query %}
<div class="posts-list">
    {% for post in posts %}
    <article class="post-card">
        <div class="post-meta">
            <time datetime="{{ post.pub_date|date:'Y-m-d' }}">{{ post.pub_date|date:"d.m.Y H:i" }}</time>
            {% if post.category %}<span class="category">Категория: {{ post.category.name }}</span>{% endif %}
        </div>
        <h2 class="post-title"><a href="{% url 'post-detail' post.pk %}">{{ post.title }}</a></h2>
        {% if post.tags.all %}
        <div class="tags">{% for tag in post.tags.all %}<span class="tag">{{ tag.name }}</span>{% endfor %}</div>
        {% endif %}
        <div class="post-excerpt">{{ post.content|truncatewords:30 }}</div>
        <a href="{% url 'post-detail' post.pk %}" class="read-more">Читать далее →</a>
    </article>
    {% empty %}
    <div class="no-results">
        <p>По вашему запросу ничего не найдено.</p>
        <a href="{% url 'post-list' %}" class="btn">Вернуться на главную</a>
    </div>
    {% endfor %}
</div>

{% if is_paginated %}
<nav class="pagination">
    {% if page_obj.has_previous %}<a href="?q={{ query }}&page={{ page_obj.previous_page_number }}">← Назад</a>{% endif %}
    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}<span class="current">{{ num }}</span>
        {% else %}<a href="?q={{ query }}&page={{ num }}">{{ num }}</a>{% endif %}
    {% endfor %}
    {% if page_obj.has_next %}<a href="?q={{ query }}&page={{ page_obj.next_page_number }}">Вперед →</a>{% endif %}
</nav>
{% endif %}

{% else %}
<div class="no-query">
    <p>Введите поисковый запрос в форме выше.</p>
</div>
{% endif %}

<style>
    .search-header { text-align: center; margin-bottom: 3rem; }
    .search-header h1 { color: #333; margin-bottom: 0.5rem; }
    .no-results, .no-query { text-align: center; padding: 3rem; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
</style>
{% endblock %}
